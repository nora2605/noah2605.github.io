<!DOCTYPE html>
<html>

<head>
	<title>Flushed.html</title>
	<link rel="stylesheet" type="text/css" href="flushed.css" />
	<link rel="favicon" type="img/x-icon" src="favicon.ico" />
	<meta property="og:type" content="website">
    <meta property="og:site_name" content="Flushed.html">
    <meta property="og:title" content="Flushed.html ðŸ˜³ðŸ˜³ðŸ˜³">
    <meta property="og:description" content="Generate Flushed Polygons omg best idea ever">
    <meta property="og:image" content="https://chickensrv.000webhostapp.com/flushed/flushed.png">
</head>

<body>

	<canvas id="flushedCanvas" width="1024" height="1024" style="color: 222;"></canvas>
	<div class="controls">
		<input type="range" value="5" min="3" max="120" step="1" id="flushedVertices" /><br>
		<input type="range" value="0.75" min="0.1" max="1" step="0.01" id="flushImageWidth" /><br>
		<input type="range" value="0.75" min="0.1" max="1" step="0.01" id="flushImageHeight" /><br>
		<input type="range" value="0" min="0" max="360" step="0.1" id="flushRotation" /><br>
		<input type="number" value="1024" min="32" max="8192" onchange="enforceMinMax(this); updateFlush();" step="1" id="flushResX" /> x
		<input type="number" value="1024" min="32" max="8192" onchange="enforceMinMax(this); updateFlush();" step="1" id="flushResY" /><br>				<input type="color" id="colorPicker" value="#ffcc4d" onchange="clickColor(0, -1, -1, 5)" /><br>
		<button id="flushedDownload">Download generated Flushed</button>
	</div>
	<script>
		let img = new Image();
		img.crossOrigin = "anonymous";
		img.onload = () => {
			updateFlush();
		}
		img.src = "./flushed.svg";
		function drawFlush(imgWidth, imgHeight, polygonVertices, polygonRotation, color) {
			let canvas = document.getElementById("flushedCanvas")
			let ctx = canvas.getContext("2d");
			ctx.clearRect(0, 0, canvas.width, canvas.height);
			let absoluteWidth = imgWidth * canvas.width;
			let absoluteHeight = imgHeight * canvas.height;
			let poly = [];
			let n = polygonVertices;
			let rot = polygonRotation * Math.PI / 180;
			for (let i = 0; i < n; i++) {
				poly.push(canvas.width / 2 + canvas.width / 2 * Math.cos((2 * Math.PI * i / n + rot)));
				poly.push(canvas.height / 2 + canvas.height / 2 * Math.sin((2 * Math.PI * i / n + rot)));
			}
			ctx.fillStyle = color;
			ctx.beginPath();
			ctx.moveTo(poly[0], poly[1]);
			for (let item = 2; item < poly.length - 1; item += 2) {
				ctx.lineTo(poly[item], poly[item + 1]);
			}
			ctx.closePath();
			ctx.fill();
			ctx.drawImage(img, (canvas.width - absoluteWidth) / 2, (canvas.height - absoluteHeight) / 2, absoluteWidth, absoluteHeight);
		}

		document.getElementById('flushedDownload').onclick = () => {
			let link = document.createElement('a');
			link.download = 'flushed.png';
			link.href = document.getElementById('flushedCanvas').toDataURL();
			link.click();
			link.remove();
		}

		function updateFlush() {
			let canvas = document.getElementById("flushedCanvas");
			let resX = document.getElementById('flushResX').value,
				resY = document.getElementById('flushResY').value;
			canvas.width = resX;
			canvas.height = resY;
			let imgw = document.getElementById('flushImageWidth').value,
				imgh = document.getElementById('flushImageHeight').value,
				pvert = document.getElementById('flushedVertices').value,
				prot = document.getElementById('flushRotation').value,								color = document.getElementById('colorPicker').value;
			drawFlush(imgw, imgh, pvert, prot, color);
			
		}
		for (let o of document.getElementsByTagName('input')) {
			o.addEventListener("input", () => {
				updateFlush();
			});
		}
		function enforceMinMax(el){
            if(el.value != "") {
                if(parseInt(el.value) < parseInt(el.min)) {
                    el.value = el.min;
                }
                if(parseInt(el.value) > parseInt(el.max)) {
                    el.value = el.max;
                }
            }
        }
	</script>
</body>

</html>